{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Drata IAM Role to set read permissions in Org Member Accounts",
  "Parameters": {
      "DrataRoleName": {
          "Type": "String",
          "Description": "Provide a role name (Example: DrataReadOnlyRole)",
          "AllowedPattern": "[-_a-zA-Z0-9]*[org|Org|ORG][-_a-zA-Z0-9]*",
          "Default": "DrataReadOnlyRole"
      },
      "ExternalID": {
          "Type": "String",
          "Description": "Provide an ExternalID (Example: Xoih821ddwf)",
          "MinLength": "1",
          "AllowedPattern": "[a-zA-Z0-9\\=\\,\\.\\@\\:\\/\\-_]*",
          "ConstraintDescription": "ExternalID must contain alphanumeric characters and only these special characters are allowed =,.@:/-. "
      }
  },
  "Resources": {
      "DrataRole": {
          "Type": "AWS::IAM::Role",
          "Properties": {
              "ManagedPolicyArns": ["arn:aws:iam::aws:policy/SecurityAudit"],
              "MaxSessionDuration": 43200,
              "AssumeRolePolicyDocument": {
                  "Version": "2012-10-17",
                  "Statement": [
                      {
                          "Effect": "Allow",
                          "Principal": {
                              "AWS": "arn:aws:iam::xxxxxxxxx:root"
                          },
                          "Action": "sts:AssumeRole",
                          "Condition": {
                              "StringEquals": {
                                  "sts:ExternalId": {
                                      "Ref": "ExternalID"
                                  }
                              }
                          }
                      }
                  ]
              },
              "RoleName": {
                  "Ref": "DrataRoleName"
              },
              "RoleDescription": "Cross-account read-only access for Drata Autopilot"
          }
      }
  },
  "Outputs": {
      "DrataARN": {
          "Value": {
              "Fn::GetAtt": ["DrataRole", "Arn"]
          },
          "Description": "Role ARN to configure within Drata Account Setup"
      }
  }
}
